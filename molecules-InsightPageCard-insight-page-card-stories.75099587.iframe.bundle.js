"use strict";(self.webpackChunk_open_sauced_app=self.webpackChunk_open_sauced_app||[]).push([[7670],{"./components/molecules/InsightPageCard/insight-page-card.stories.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{InsightpageCardStory:()=>InsightpageCardStory,__namedExportsOrder:()=>__namedExportsOrder,default:()=>insight_page_card_stories});var defineProperty=__webpack_require__("./node_modules/@babel/runtime/helpers/esm/defineProperty.js"),react=__webpack_require__("./node_modules/next/dist/compiled/react/index.js"),next_link=__webpack_require__("./node_modules/next/link.js"),link_default=__webpack_require__.n(next_link),index_esm=__webpack_require__("./node_modules/@primer/octicons-react/dist/index.esm.js"),bs=__webpack_require__("./node_modules/react-icons/bs/index.mjs"),Button_button=__webpack_require__("./components/shared/Button/button.tsx"),Typography_text=__webpack_require__("./components/atoms/Typography/text.tsx"),date_utils=__webpack_require__("./lib/utils/date-utils.ts"),get_repo_insights=__webpack_require__("./lib/utils/get-repo-insights.ts"),useRepositories=__webpack_require__("./lib/hooks/api/useRepositories.ts"),copy_to_clipboard=__webpack_require__("./lib/utils/copy-to-clipboard.ts"),card_repo_list=__webpack_require__("./components/molecules/CardRepoList/card-repo-list.tsx"),pie_chart=__webpack_require__("./components/molecules/PieChart/pie-chart.tsx"),stacked_avatar=__webpack_require__("./components/molecules/StackedAvatar/stacked-avatar.tsx"),__jsx=react.createElement;const InsightPageCard=_ref=>{let{insight,user}=_ref;const members=[],repoIds=insight.repos.map((repo=>repo.repo_id)),{data:repoData}=(0,useRepositories.Z)(repoIds),{open,closed,merged,drafts,velocity,total,repoList}=(0,get_repo_insights.Z)(repoData),PieChartData=[{label:"open",value:open,id:"open",color:"hsla(131, 41%, 46%, 1)"},{label:"merged",value:merged,id:"merged",color:"hsla(272, 51%, 54%, 1)"},{label:"closed",value:closed,id:"closed",color:"hsla(11, 89%, 54%, 1)"},{label:"draft",value:drafts,id:"draft",color:"hsla(205, 11%, 78%, 1)"}],averagePrOpened=repoData.length>0?Math.round((open||0)/total*100):0;return __jsx("div",{className:" w-[428px] py-[15px] px-[14px] rounded-lg flex flex-col gap-y-3 gap-x-2 bg-white border"},__jsx("div",{className:"flex items-center justify-between"},__jsx("div",null,insight.name),__jsx("div",{className:"items-center flex"},members.length>0?__jsx(stacked_avatar.Z,{visibleQuantity:2,contributors:members}):"",members.length>2?__jsx("div",null,"Â ","+".concat(members.length-2," members")):"")),__jsx("div",{className:"flex justify-between items-center"},__jsx("div",{className:"flex-1 pl-6"},__jsx(pie_chart.Z,{data:PieChartData})),__jsx("div",{className:"flex gap-2 flex-1 flex-col"},__jsx("div",{className:"flex flex-col"},__jsx("span",{className:"text-xs text-light-slate-11"},"Avg PRs opened"),__jsx("div",{className:"flex text-light-grass-10 justify-between items-end pr-8 mt-1 "},__jsx(Typography_text.Z,{className:"!text-xl !text-black !leading-none"},"".concat(open," PR").concat(open>1?"s":"")),__jsx("p",{className:"flex items-end"},__jsx("span",{className:"mb-0 leading-none"},"".concat(averagePrOpened,"%"))," ",__jsx(bs.gtS,{className:"ml-1"})))),__jsx("div",null,__jsx("span",{className:"text-xs text-light-slate-11"},"Avg PRs velocity"),__jsx("div",{className:"flex text-green-9 justify-between items-end pr-8 mt-1"},__jsx(Typography_text.Z,{className:"!text-xl !text-black !leading-none"},repoData.length>0?(0,date_utils.MK)(Math.round(velocity/repoData.length)):"-"),__jsx("p",{className:"flex items-end"},__jsx("span",{className:"mb-0 leading-none"},total>0?"".concat(Math.round(merged/total*100),"%"):"-")," ",__jsx(bs.gtS,{className:"ml-1",fill:"green",color:"green"})))))),__jsx("div",{className:"mt-4"},__jsx(card_repo_list.Z,{repoList,limit:2})),__jsx("div",{className:"flex mt-4 justify-between"},__jsx(Button_button.Z,{onClick:()=>(0,copy_to_clipboard.vQ)("".concat(new URL("/pages/".concat(null==user?void 0:user.user_metadata.user_name,"/").concat(insight.id,"/dashboard"),location.origin))),className:"w-48",variant:"outline"}," ",__jsx(index_esm.xPt,{size:16,className:"mr-2"})," Copy Link"),__jsx(link_default(),{href:"/pages/".concat(null==user?void 0:user.user_metadata.user_name,"/").concat(insight.id,"/dashboard")},__jsx(Button_button.Z,{className:"w-48",variant:"primary"},"Go to Insight Page"))))};InsightPageCard.displayName="InsightPageCard";const insight_page_card=InsightPageCard;try{insightpagecard.displayName="insightpagecard",insightpagecard.__docgenInfo={description:"",displayName:"insightpagecard",props:{user:{defaultValue:null,description:"",name:"user",required:!0,type:{name:"User | null"}},insight:{defaultValue:null,description:"",name:"insight",required:!0,type:{name:"DbUserInsight"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["components/molecules/InsightPageCard/insight-page-card.tsx#insightpagecard"]={docgenInfo:insightpagecard.__docgenInfo,name:"insightpagecard",path:"components/molecules/InsightPageCard/insight-page-card.tsx#insightpagecard"})}catch(__react_docgen_typescript_loader_error){}var _InsightpageCardStory,_InsightpageCardStory2,test_repo_avatar=__webpack_require__("./img/icons/test-repo-avatar.svg"),insight_page_card_stories_jsx=react.createElement;function ownKeys(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,o)}return t}function _objectSpread(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?ownKeys(Object(t),!0).forEach((function(r){(0,defineProperty.Z)(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):ownKeys(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}const insight_page_card_stories={title:"Design System/Molecules/InsightPageCard"},InsightPageCardTemplate=(test_repo_avatar.Z,test_repo_avatar.Z,test_repo_avatar.Z,test_repo_avatar.Z,test_repo_avatar.Z,test_repo_avatar.Z,args=>insight_page_card_stories_jsx(insight_page_card,args));InsightPageCardTemplate.displayName="InsightPageCardTemplate";const InsightpageCardStory=InsightPageCardTemplate.bind({});InsightpageCardStory.args={},InsightpageCardStory.parameters=_objectSpread(_objectSpread({},InsightpageCardStory.parameters),{},{docs:_objectSpread(_objectSpread({},null===(_InsightpageCardStory=InsightpageCardStory.parameters)||void 0===_InsightpageCardStory?void 0:_InsightpageCardStory.docs),{},{source:_objectSpread({originalSource:"args => <InsightPageCard {...args} />"},null===(_InsightpageCardStory2=InsightpageCardStory.parameters)||void 0===_InsightpageCardStory2||null===(_InsightpageCardStory2=_InsightpageCardStory2.docs)||void 0===_InsightpageCardStory2?void 0:_InsightpageCardStory2.source)})});const __namedExportsOrder=["InsightpageCardStory"]},"./components/molecules/PieChart/pie-chart.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Z:()=>__WEBPACK_DEFAULT_EXPORT__});var react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/next/dist/compiled/react/index.js"),_nivo_pie__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/@nivo/pie/dist/nivo-pie.es.js"),__jsx=react__WEBPACK_IMPORTED_MODULE_0__.createElement;const PieChart=_ref=>{let{data}=_ref;return __jsx("div",{className:"w-[135px] h-[135px]"},__jsx(_nivo_pie__WEBPACK_IMPORTED_MODULE_1__.Y2,{data,margin:{top:5,right:5,bottom:5,left:5},innerRadius:.65,padAngle:2,cornerRadius:4,activeInnerRadiusOffset:4,activeOuterRadiusOffset:4,colors:{datum:"data.color"},borderColor:{from:"color"},enableArcLinkLabels:!1,enableArcLabels:!1,arcLabelsSkipAngle:10,arcLabelsTextColor:{from:"color"},tooltip:function(e){var t=e.datum;return __jsx("div",{className:"bg-white py-1 px-2 rounded-lg shadow-xs"},__jsx("div",{className:"flex gap-1 items-center text-light-slate-12 text-xs   capitalize"},__jsx("div",{className:"w-2 h-2 rounded-full mr-1",style:{backgroundColor:t.color}}),__jsx("span",{className:"font-semibold text-light-slate-11"},t.label,":")," ",t.formattedValue," PRs"))},motionConfig:"stiff",legends:[],layers:[_ref2=>{let{dataWithArc,centerX,centerY}=_ref2,total=0;return dataWithArc.forEach((datum=>{total+=datum.value})),__jsx("text",{x:centerX,y:centerY,textAnchor:"middle",dominantBaseline:"central"},total," PRs")},"arcs","arcLabels","arcLinkLabels","legends"]}))};PieChart.displayName="PieChart";const __WEBPACK_DEFAULT_EXPORT__=PieChart;try{piechart.displayName="piechart",piechart.__docgenInfo={description:"",displayName:"piechart",props:{data:{defaultValue:null,description:"",name:"data",required:!0,type:{name:"PieData[]"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["components/molecules/PieChart/pie-chart.tsx#piechart"]={docgenInfo:piechart.__docgenInfo,name:"piechart",path:"components/molecules/PieChart/pie-chart.tsx#piechart"})}catch(__react_docgen_typescript_loader_error){}},"./components/molecules/StackedAvatar/stacked-avatar.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Z:()=>stacked_avatar});var react=__webpack_require__("./node_modules/next/dist/compiled/react/index.js"),next_router=__webpack_require__("./node_modules/next/router.js"),clsx_m=__webpack_require__("./node_modules/clsx/dist/clsx.m.js"),avatar_hover_card=__webpack_require__("./components/atoms/Avatar/avatar-hover-card.tsx"),dist=__webpack_require__("./node_modules/swr/core/dist/index.mjs"),public_api_fetcher=__webpack_require__("./lib/utils/public-api-fetcher.ts");const hooks_useInsight=id=>{const baseEndpoint="insights/".concat(id),endpointString="".concat(baseEndpoint),{data,error,mutate}=(0,dist.ZP)(id?endpointString:null,public_api_fetcher.N);return{data,isLoading:!error&&!data,isError:!!error&&Object.keys(error).length>0,mutate}};var fallback_values=__webpack_require__("./lib/utils/fallback-values.ts"),console=__webpack_require__("./node_modules/console-browserify/index.js"),__jsx=react.createElement;const StackedAvatar=_ref=>{let{contributors,visibleQuantity=5,classNames}=_ref;const router=(0,next_router.useRouter)(),{pageId}=router.query,insightId=Number.isInteger(parseInt(pageId,10))?pageId:"",{data:insight,isError}=hooks_useInsight(insightId),repositories=insight?insight.repos.map((repo=>repo.repo_id)):[];return isError?(console.log("Error fetching insight",isError),__jsx("div",null,fallback_values.I)):__jsx("div",{className:(0,clsx_m.Z)("flex -space-x-3 transition-all duration-300 hover:-space-x-1",classNames)},contributors&&contributors.slice(0,visibleQuantity).map((_ref2=>{let{host_login:hostLogin}=_ref2;return __jsx("div",{key:"contributor-avatar-".concat(hostLogin),className:"w-8 h-8 overflow-hidden transition-all duration-300 border-2 border-white border-solid rounded-full"},__jsx(avatar_hover_card.Z,{contributor:hostLogin,repositories}))})))};StackedAvatar.displayName="StackedAvatar";const stacked_avatar=StackedAvatar;try{stackedavatar.displayName="stackedavatar",stackedavatar.__docgenInfo={description:"",displayName:"stackedavatar",props:{contributors:{defaultValue:null,description:"",name:"contributors",required:!0,type:{name:"Contributor[]"}},visibleQuantity:{defaultValue:{value:"5"},description:"",name:"visibleQuantity",required:!1,type:{name:"number"}},classNames:{defaultValue:null,description:"",name:"classNames",required:!1,type:{name:"string"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["components/molecules/StackedAvatar/stacked-avatar.tsx#stackedavatar"]={docgenInfo:stackedavatar.__docgenInfo,name:"stackedavatar",path:"components/molecules/StackedAvatar/stacked-avatar.tsx#stackedavatar"})}catch(__react_docgen_typescript_loader_error){}},"./lib/hooks/api/useRepositories.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Z:()=>__WEBPACK_DEFAULT_EXPORT__});var react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/next/dist/compiled/react/index.js"),swr__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/swr/core/dist/index.mjs"),next_router__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/next/router.js"),lib_utils_public_api_fetcher__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./lib/utils/public-api-fetcher.ts"),lib_utils_get_filter_query__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./lib/utils/get-filter-query.ts");const __WEBPACK_DEFAULT_EXPORT__=function(){var _data$data,_data$meta;let repoIds=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],range=arguments.length>1&&void 0!==arguments[1]?arguments[1]:30,limit=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10;const router=(0,next_router__WEBPACK_IMPORTED_MODULE_2__.useRouter)(),{0:page,1:setPage}=(0,react__WEBPACK_IMPORTED_MODULE_0__.useState)(1),{pageId,selectedFilter}=router.query,topic=pageId,filterQuery=(0,lib_utils_get_filter_query__WEBPACK_IMPORTED_MODULE_4__.Z)(selectedFilter),query=new URLSearchParams(filterQuery);topic&&Number.isNaN(Number(topic))&&query.set("topic",topic),page&&query.set("page","".concat(page)),limit&&query.set("limit","".concat(limit)),range&&query.set("range","".concat(range)),(null==repoIds?void 0:repoIds.length)>0&&(query.delete("topic"),query.set("repoIds",repoIds.join(","))),query.get("repo")&&query.delete("topic");const endpointString="".concat("repos/search","?").concat(query),{data,error,mutate}=(0,swr__WEBPACK_IMPORTED_MODULE_1__.ZP)(endpointString,lib_utils_public_api_fetcher__WEBPACK_IMPORTED_MODULE_3__.N);return{data:null!==(_data$data=null==data?void 0:data.data)&&void 0!==_data$data?_data$data:[],meta:null!==(_data$meta=null==data?void 0:data.meta)&&void 0!==_data$meta?_data$meta:{itemCount:0,limit:0,page:0,hasNextPage:!1,hasPreviousPage:!1,pageCount:0},isLoading:!error&&!data,isError:!!error,mutate,page,setPage}}},"./lib/utils/copy-to-clipboard.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{vQ:()=>copyToClipboard,zA:()=>copyNodeAsImage});var _sentry_nextjs__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/@sentry/core/esm/exports.js"),_shorten_url__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./lib/utils/shorten-url.ts"),console=__webpack_require__("./node_modules/console-browserify/index.js");let html2canvas;const copyToClipboard=async content=>{try{const shortUrl=await(0,_shorten_url__WEBPACK_IMPORTED_MODULE_0__.X)(content);await navigator.clipboard.writeText(shortUrl)}catch(error){console.log("This browser does not support the clipboard.",error)}};async function copyNodeAsImage(node,options){if(!node)throw new Error("Failed to copy image to clipboard");await navigator.clipboard.write([new ClipboardItem({"image/png":new Promise((async(resolve,reject)=>{try{html2canvas||(html2canvas=(await __webpack_require__.e(6762).then(__webpack_require__.t.bind(__webpack_require__,"./node_modules/html2canvas-pro/dist/html2canvas-pro.js",23))).default),html2canvas(node,options).then((canvas=>{canvas.toBlob((blob=>{blob?resolve(new Blob([blob],{type:"image/png"})):reject("Failed to copy image to clipboard")}),"image/png")}))}catch(err){reject("Failed to copy image to clipboard"),(0,_sentry_nextjs__WEBPACK_IMPORTED_MODULE_1__.Tb)(new Error("Failed to copy image to clipboard",{cause:err}))}}))})])}},"./lib/utils/fallback-values.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{I:()=>DATA_FALLBACK_VALUE});const DATA_FALLBACK_VALUE="-"},"./lib/utils/get-repo-insights.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Z:()=>__WEBPACK_DEFAULT_EXPORT__});const __WEBPACK_DEFAULT_EXPORT__=repos=>{const repoList=repos.map((repo=>{const[repoOwner,repoName]=repo.full_name.split("/");return{repoIcon:"https://github.com/".concat(repoOwner,".png?size=60"),repoName,repoOwner}})),repoTotals=repos.reduce(((totals,curr)=>{const merged=(totals.merged||0)+(curr.merged_prs_count||0),opened=(totals.opened||0)+(curr.open_prs_count||0),closed=(totals.closed||0)+(curr.closed_prs_count||0),drafts=(totals.drafts||0)+(curr.draft_prs_count||0);return{merged,opened,closed,drafts,churn:(totals.churn||0)+(curr.churnTotalCount||0),velocity:(totals.velocity||0)+(curr.pr_velocity_count||0),total:(totals.total||0)+merged+opened+closed+drafts}}),{});return{repoList,open:repoTotals.opened||0,merged:repoTotals.merged||0,closed:repoTotals.closed||0,drafts:repoTotals.drafts||0,total:repoTotals.total||0,velocity:repoTotals.velocity||0,churn:repoTotals.churn||0}}},"./lib/utils/shorten-url.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{X:()=>shortenUrl});var _sentry_nextjs__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@sentry/core/esm/exports.js");async function shortenUrl(url){try{const response=await fetch("".concat("https://beta.api.opensauced.pizza/v2","/url/shorten?url=").concat(encodeURIComponent(url)));if(response.ok){return(await response.json()).shortUrl}}catch(e){_sentry_nextjs__WEBPACK_IMPORTED_MODULE_0__.Tb(new Error("Failed to shorten URL ".concat(url),{cause:e}))}return url}},"./img/icons/test-repo-avatar.svg":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Z:()=>__WEBPACK_DEFAULT_EXPORT__});const __WEBPACK_DEFAULT_EXPORT__={src:"static/media/test-repo-avatar.44d8c630.svg",height:24,width:24,blurDataURL:"static/media/test-repo-avatar.44d8c630.svg"}}}]);